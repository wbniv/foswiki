%META:TOPICINFO{author="TWikiContributor" date="1167752717" format="1.1" version="$Rev$"}%
---+!! <nop>%TOPIC%
<!--

   PLEASE DO NOT EDIT THIS TOPIC

   It is automatically generated from the subversion repository, and any changes
   you make will simply be overwritten the next time a release is generated.

   Instead, you could check your fix in, raise a bug in the Bugs web, or mail the author.
-->
%TOC%
This plugin provides an interface to query an LDAP directory and display the results in a TWiki topic.
It is a complete rewrite of the TWiki:Plugins/LdapPlugin by TWiki:Main.GerardHickey to provide
greater flexibility and performance based on the TWiki:Plugins/LdapContrib package.

---++ Syntax Rules
<verbatim>
%LDAP{(filter=)"filter" ...}%
</verbatim>

Parameters:
   * =filter=: the LDAP query string
   * =host=: host IP or name to connect to
   * =port=: port to of the host
   * =version=: protocol version; possible values: 2,3
   * =ssl=: use ssl to bind to the server; possible values 0,1
   * =base=: base dn of the (sub)tree to search in; 
     if =base= is written in brackets (e.g. 'base="(ou=people)"') then it is prepended to the default
     base of the LdapContrib
   * =scope=: scope of search; possible values: sub, base, one
   * =format=: format string used to display a database record
   * =header=: header to prepend the output; default: '$dn'
   * =footer=: footer to appended to the output
   * =sep=: separator between database records; default: '$n'
   * =sort=: name of attributes to sort the output
   * =reverse=: reverse the result set; possible values: on, off; default: off
   * =limit=: maximum number of records to return; default: 0 (unlimited)
   * =skip=: number of records in the hit set to skip before displaying them; default: 0 
   * =hidenull=: wether to hide any output on an empty hit set; possible values: on, off; default: off

Cgi Parameters:
   * =refresh=: refresh the cache of blobs (i.e. jpegPhotos); possible values: on, off; default: off;
     (right now only the jpegPhoto attribute is recognized as a blob)

The =header=, =format= and =footer= format strings may contain the following variables:
   * $percnt: % sign
   * $dollar: $ sign
   * $n: newline
   * $count: the number of hits
   * $index: the record number
   * $&lt;attr-name>: the value of the record attribute &lt;attr-name>
 
---++ Examples
%LDAP{"(objectClass=posixAccount)" base="(ou=people)" limit="10" header="| *Nr* | *Name* | *Mail* | *Photo* |" format="| $index | $cn | $mail | <img src=\"$jpegPhoto\" alt=\"$cn\" title=\"$cn\" width=\"100px\"> |" footer="<br/><font color='red'>$count users</font>" sort="cn"}%

%LDAP{"(objectClass=posixGroup)" base="(ou=group)" limit="10" header="| *Nr* | *Group* | *Members* |" format="| $index | $cn | $memberUid |" sort="cn"}%

---++ Plugin Settings
<!-- provided for compatibility only
   * Set SHORTDESCRIPTION = Query and display data from an LDAP directory
-->

The %TOPIC% will use the default configuration of the LdapContrib in your =LocalSite.cfg= file, that is
   * $TWiki::cfg{Ldap}{Host} (overridable per query)
   * $TWiki::cfg{Ldap}{Port} (overridable per query)
   * $TWiki::cfg{Ldap}{Base} (overridable per query)
   * $TWiki::cfg{Ldap}{Version} (overridable per query)
   * $TWiki::cfg{Ldap}{SSL} (overridable per query)
   * $TWiki::cfg{Ldap}{BindDN}
   * $TWiki::cfg{Ldap}{BindPasswd}

---++ Plugin Installation Instructions
   * Download the ZIP file from the Plugin web (see below)
   * Unzip ==%TOPIC%.zip== in your twiki installation directory. Content:
     | *File:* | *Description:* |
     | ==data/TWiki/%TOPIC%.txt== | Plugin topic |
     | ==data/TWiki/%TOPIC%.txt,v== | Plugin topic repository |
     | ==lib/TWiki/Plugins/%TOPIC%.pm== | Plugin Perl module |
     | ==lib/TWiki/Plugins/%TOPIC%/Core.pm== | Plugin Perl module |
   * Optionally, run ==%TOPIC%_installer.pl== to automatically check and
     install other TWiki modules that this module depends on. You can also do
     this step manually.
   * Alternatively, manually make sure the dependencies listed in the table
     below are resolved.
     %$DEPENDENCIES%

---++ Plugin Info
|  Plugin Author: | TWiki:Main.MichaelDaum |
|  Copyright &copy;: | 2006 Michael Daum http://wikiring.com %BR% \
   This work was partly funded by Spanlink Communications |
|  License: | GPL ([[http://www.gnu.org/copyleft/gpl.html][GNU General Public License]]) |
|  Plugin Version: | v1.01 |
|  Change History: | &nbsp; |
|  04 June 2007: | don't convert from/to utf8 if the site charset is already utf8 |
|  18 Dec 2006: | added support for addresses as specified in RFC4517 |
|  04 Dec 2006: | map utf8 strings from LDAP to the site's encoding and vice versa |
|  30 Nov 2006: | replaced commonTagsHandler with a properly registered LDAP tag |
|  31 Aug 2006: | added NO_PREFS_IN_TOPIC |
|  19 Jul 2006: | public release |
|  25 April 2006: | Initial (internal) version |
|  Perl Version: | 5.8 |
|  TWiki:Plugins/Benchmark: | %SYSTEMWEB%.GoodStyle nn%, %SYSTEMWEB%.FormattedSearch nn%, %TOPIC% nn% |
|  Plugin Home: | TWiki:Plugins/%TOPIC% |
|  Feedback: | TWiki:Plugins/%TOPIC%Dev |

-- TWiki:Main/MichaelDaum - 04 June 2006
