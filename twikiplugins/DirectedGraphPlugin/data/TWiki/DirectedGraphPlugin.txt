%META:TOPICINFO{author="TWikiContributor" date="1150151343" format="1.1" reprev="1.6" version="1.6"}%
---+!! Directed Graph Plugin

%TOC%

---++ Introduction

Graph visualization is a way of representing structural information as diagrams of abstract graphs and networks. Automatic graph drawing has many important applications in software engineering, database and web design, networking, and in visual interfaces for many other domains.

This plugin uses [[http://www.graphviz.org/][Graphviz's]] applications to create a png image of a directed graph. The graph is described in a simple text markup called "the DOT language".

Visit the [[http://www.graphviz.org/Gallery.php][Graphviz gallery]] to see some examples on what can be achived with this plugin and Graphviz. Full documentation is available at http://graphviz.org/Documentation.php.

<nop>DirectedGraphPlugin supports the following engines:

	* =dot= - makes "hierarchical" or layered drawings of directed graphs. The layout algorithm aims edges in the same direction (top to bottom, or left to right) and then attempts to avoid edge crossings and reduce edge length.
	* =neato= and =fdp= - make "spring model" layouts. neato uses the Kamada-Kawai algorithm, which is equivalent to statistical multi-dimensional scaling. fdp implements the Fruchterman-Reingold heuristic including a multigrid solver that handles larger graphs and clustered undirected graphs.
	* =twopi= - radial layout, after Graham Wills 97.
	* =circo= - circular layout, after Six and Tollis 99, Kauffman and Wiese 02. Suitable for certain diagrams of multiple cyclic structures. 

---++ Syntax Rules

Enclose the description for your directed graph within =&lt;dot&gt;= ... =&lt;/dot&gt;= tags.

You can use the following parameters in the =dot= tag to control the rendering of your graph:

	  | *Parameter:* | *Description:* | *Default:* |
	  | =antialias="on"= | Enable antialising of current graph by setting this to =on=. | =off= |
	  | =density="300"= | Input parameter for the =convert= utility from imagemagick. | =300= |
	  | =size="2000x1600"= | When antialiasing is =on=, this parameter controls size of rendered image (use =size= parameter in graph description for controlling the size of the image with antialiasing =off=). | =800x600= |
	  | =map="on"= | Create a client side map for the generated image. This will turn any =[URL="..."];= attribute in the graph description into a clickable area (see demonstration below). | =off= |
	  | =vectorformats="ps svg"= | The PNG file created from the graph per default is a bitmap file. If you need a vectorbased file rendering as well, you can specify =ps= or =svg= formats (will be attached to topic, visible under attachments view). | none |
	  | =engine="neato"= | Which layout engine to use for the graph: One of =dot=, =neato=, =twopi=, =circo= or =fdp=. | =dot= |
	  | =library="Main.GroupIcons"= | Which icon library topic to use for custom shapes ([shapefile] parameter). Needs to be explicitly set, also if icons are attached locally to the current graph topic. See demo below. | =TWiki.DirectedGraphPlugin= |
	  
Sitewide default settings are set in this topic and can be overwritten for each graph. When you change a setting the graph will be re-generated.

---++ Howto

HowtoDirectedGraphs has a basic howto on creating directed graphs using dot.

---++ Examples

---+++ Cole's example

__You type:__
<verbatim>
<dot>
digraph G {
	 subgraph cluster_c0 {a0 -> a1 -> a2 -> a3}
	 subgraph cluster_c1 {
		  b0 -> b1 -> b2 -> b3;
		  label="Group B";
	 }
	 x -> a0 [style=dotted];
	 x -> b0;
	 a1 -> a3 [style=bold, label="a1 to a3"];
	 a3 -> a0;
	 a0 [shape=box, fontname=Courier, fontsize=11];
	 a1 [color=red];
	 a3 [label="Label\nfor a3"];
	 label="Cole's Example";
}
</dot> 
</verbatim> 

<table><tr><td valign="top" width="50%">
__You get: (simulated)__ <br />
<img src="%ATTACHURLPATH%/graphsample.png" alt="graphsample.png"  width="344" height="570"  />
</td><td valign="top" width="50%">
__You get: (if installed)__ <br />
<dot>
digraph G {
	 subgraph cluster_c0 {a0 -> a1 -> a2 -> a3}
	 subgraph cluster_c1 {
		  b0 -> b1 -> b2 -> b3;
		  label="Group B";
	 }
	 x -> a0 [style=dotted];
	 x -> b0;
	 a1 -> a3 [style=bold, label="a1 to a3"];
	 a3 -> a0;
	 a0 [shape=box, fontname=Courier, fontsize=11];
	 a1 [color=red];
	 a3 [label="Label\nfor a3"];
	 label="Cole's Example";
}
</dot> 
</td></tr></table>

---+++ Clientside imagemap (clickable nodes and edges)

__You type:__
<verbatim>
<dot map=1>
digraph G {
	 URL="http://www.twiki.org";
	 Plugins [URL="http://twiki.org/cgi-bin/view/Plugins/PluginPackage"];
	 DirectedGraphPlugin [URL="http://twiki.org/cgi-bin/view/Plugins/DirectedGraphPlugin"];
	 Plugins -> DirectedGraphPlugin;
}
</dot>
</verbatim>

<table><tr><td valign="top" width="25%">
__You get: (simulated)__ <br />
<map id="sample" name="sample">
<area shape="rect" href="http://twiki.org/cgi&#45;bin/view/Plugins/PluginPackage" title="Plugins" alt="" coords="60,8,150,56" />
<area shape="rect" href="http://twiki.org/cgi&#45;bin/view/Plugins/DirectedGraphPlugin" title="DirectedGraphPlugin" alt="" coords="8,104,202,152" />
<area shape="rect" href="http://www.twiki.org" alt="" coords="8,8,202,152" />
</map>
<img usemap="#sample" src="%ATTACHURLPATH%/graphsample2.png"/>
</td><td valign="top" width="25%">
__You get: (if installed)__ <br />
<dot map="1">
digraph G {
	 URL="http://www.twiki.org";
	 Plugins [URL="http://twiki.org/cgi-bin/view/Plugins/PluginPackage"];
	 DirectedGraphPlugin [URL="http://twiki.org/cgi-bin/view/Plugins/DirectedGraphPlugin"];
	 Plugins -> DirectedGraphPlugin;
}
</dot>
</td>
<td valign="top" width="25%">
__You get: (simulated, antialising on)__ <br />
<img usemap="#sample" src="%ATTACHURLPATH%/graphsample2_antialiased.png" alt="graphsample2_antialiased.png" width='205' height='154' />
</td>
<td valign="top" width="25%">
__You get: (if installed, antialising on)__ <br />
<dot map="1" antialias="on" size="205x155">
digraph G {
	 URL="http://www.twiki.org";
	 Plugins [URL="http://twiki.org/cgi-bin/view/Plugins/PluginPackage"];
	 DirectedGraphPlugin [URL="http://twiki.org/cgi-bin/view/Plugins/DirectedGraphPlugin"];
	 Plugins -> DirectedGraphPlugin;
}
</dot>
</td>
</tr></table>

---+++ Usecase description / state diagram

View source of this page to see graph description.

<table><tr><td valign="top" width="25%">
__You get: (simulated)__ <br />
<img src="%ATTACHURLPATH%/usecase_sample.png" alt="usecase_sample.png" width='534' height='1000' />
</td>
<td valign="top" width="25%">
__You get: (if installed)__ <br />
<dot antialias="on" size="1000x1000">
digraph G {
 size="7,7";
 graph [rankdir="TB" label="1st Time Use/Phone Registration" fontsize=12 bgcolor="#eeeeff"];
	node [shape=box fontsize=9];
	edge [color=blue fontsize=8 font="Arial"];

	cell_number_entry [label="Cell Number Entry"];
	welcome [label="Welcome Page"];
	member_name_creation [label="Member Name Creation"];
	password_creation [label="Password Creation"];
	member_name_unavailable [label="Member Name Unavailable"];
	email_entry [label="Email Entry"];
	zip_code_entry [label="Zip Code Entry"];
	tos [label="TOS"];
	decline_confirmation [label="Decline Confirmation"];
	registration_confirmation [label="Registration Confirmation"];
	member_name_entry [label="Member Name Entry"];
	password_entry [label="Password Entry"];
	confirm_phone_number [label="Confirm Phone Number"];
	unsuccessfull_sign_in [label="Unsuccessfull Sign In"];
	email_confirmation [label="Email Confirmation"];
	main_menu [label="Main Menu"];
	initial_screen [label="Initial Screen"];
	exit_application [label="Exit the Application"];

	welcome -> initial_screen [label="First Time"]
	initial_screen -> member_name_creation [label="Register"];
	initial_screen -> member_name_entry [label="Sign In"];
	member_name_creation -> password_creation [label="Valid Member Name" dir="both"];
	member_name_creation -> member_name_unavailable [label="Invalid Member Name" dir="both"];
	welcome -> password_creation;
	password_creation -> cell_number_entry [dir="both"];
	member_name_entry -> password_entry [dir="both"];
	cell_number_entry -> email_entry [dir="both"];
	password_entry -> confirm_phone_number [label="Auth. Successful" dir="both"];
	password_entry -> unsuccessfull_sign_in [label="Auth. Unsuccessful"];
	email_entry -> zip_code_entry [dir="both"];
	zip_code_entry -> tos [dir="both"];
	confirm_phone_number -> main_menu;
	unsuccessfull_sign_in -> member_name_entry [label="Try Again" constraint="false"];
	unsuccessfull_sign_in -> email_confirmation;
	tos -> decline_confirmation [label="Decline" dir="both"];
	tos -> registration_confirmation [label="Accept"];
	decline_confirmation -> exit_application [label="Yes"];
	registration_confirmation -> main_menu [label="10 Sec/NEXT"]; 
}
</dot>
</td>
</tr></table>

---+++ Component architecture

This is a typical example of a component architecture drawing (This kind of graph is also easy to do in TWiki:Plugins.TWikiDrawPlugin if you like the look but you prefer to draw it manually using your mouse).

View source of this page for graph description.

<table><tr><td valign="top" width="25%">
__You get: (simulated)__ <br />
<img src="%ATTACHURLPATH%/sample_component_architecture.png" alt="sample_component_architecture.png" width='918' height='251' />
</td></tr>
<tr><td valign="top" width="25%">
__You get: (if installed)__ <br />
<dot antialias="on" size="918x251" map="on">
digraph G {
  graph [rankdir=LR, size="9.5,2.5"]
  subgraph cluster_0 {
	 graph [label=User]
	 edge [style=dashed]
	 browser [label="WWW\nbrowser" URL="http://www.mozilla.org/"]
	 svgplugin [label="SVG Plugin" URL="http://www.adobe.com/svg/viewer/install/old.html"]
	 pdfplugin [label="PDF Plugin" URL="http://www.adobe.com/support/downloads/product.jsp?product=10&platform=unix"]
	 svgplugin -> browser
	 svgplugin -> browser [dir=back]
	 pdfplugin -> browser
	 pdfplugin -> browser [dir=back]
	 {
		graph [rank=same]
		pngpage [label=PNG shape=box URL="/cgi-bin/webdot/webdot/demo.dot.dot.png"]
		svgpage [label=SVGZ shape=box URL="/cgi-bin/webdot/webdot/demo.dot.dot.svgz"]
		pdfpage [label=PDF shape=box URL="/cgi-bin/webdot/webdot/demo.dot.dot.pdf"]
	 }
	 pngpage -> browser [dir=none style=dotted]
	 svgpage -> svgplugin [dir=none style=dotted]
	 pdfpage -> pdfplugin [dir=none style=dotted]
  }
  subgraph cluster_1 {
	 graph [label="Server 1"]
	 httpd1 [label=httpd URL="http://httpd.apache.org/"]
	 webdot [label="/cgi-bin/webdot" style=filled fillcolor=yellow color=black URL="/webdot/"]
  }
  subgraph cluster_2 {
	 graph [label="Server 2"]
	 httpd2 [label=httpd URL="http://httpd.apache.org/"]
	 "demo.dot" [shape=box URL="/webdot/demo.dot"]
	 httpd2 -> "demo.dot" [dir=none style=dotted]
  }
  browser -> httpd1 -> webdot -> httpd2
  browser -> httpd1 -> webdot -> httpd2 [dir=back]
}
</dot>
</td>
</tr></table>

---+++ Simple LAN setup (custom icons / shapefiles)

This type of graph can also easily be extended, for instance making network nodes clickable, pointing to asset databases or similar.

View source of this page for graph description.

<table><tr><td valign="top" width="25%">
__You get: (simulated)__ <br />
<img src="%ATTACHURLPATH%/sample_simple_lan_setup.png" alt="sample_simple_lan_setup.png" width='206' height='300' />
</td>
<td valign="top" width="25%">
__You get: (if installed)__ <br />
<dot engine="dot" antialias="on" size="300x300" library="TWiki.DirectedGraphPlugin">
digraph G {
	 edge [arrowhead=none color=blue];
	 node [fontcolor=blue color=white];

	 Workstation [shapefile="Sun_Workstation.png"];
	 Printer [shapefile="Printer.png"];
	 Internet [shapefile="Cloud-Filled.png"];
	 Router [shapefile="Wireless_Router.png"];
	 Switch [shapefile="Workgroup_Switch.png"];
	 Laptop [shapefile="Laptop.png"];

	 Workstation -> Switch;
	 Printer -> Switch;
	 Switch -> Router;
	 Router -> Internet;
	 Laptop -> Router [style=dotted];
}
</dot>
</td>
</tr></table>



---++ <nop>%TOPIC% Global Settings

	* One line description, shown in the %SYSTEMWEB%.TextFormattingRules topic:
		* Set SHORTDESCRIPTION = Embed directed graphs in TWiki topics (using the Graphviz package)

	* Layout engine to use per default. Can be one of =dot=, =neato=, =twopi=, =circo=, =fdp=
		* Set ENGINE = dot

	* Antialias option. If set to =on= the plugin will use the =convert= binary from the imagemagick package to pretty print graphs. This option should not be used with clientside maps as pixel dimensions are usually altered in this process and therefore the "hot spot" locations will not match the generated image. With antialising off, rendering size is controlled by =dot= (can be effected by an eventual size parameter in the digraph description), with antialising on you set the final image size in pixels explicitly with the size parameter. (If you must use an image map with this option, take care manually that the two generated pixel sizes match).
		* Set ANTIALIAS = off

	* Default density (dpi) for antialias option. 300 dpi should be sufficient for most purposes (if your graphs look blurred at large image sizes try using a higher value).
		* Set DENSITY = 300

	* Default image size (pixels, =widthxheight=) for antialias option (keeps aspect ratio; enlarges until max of one of the dimensions is reached).
		* Set SIZE = 800x600

	* Additional vector formats to create per default. Displayed version is always PNG, others are attached. Options are =ps= and =svg= (comma separated). The =ps= format is useful to have handy if you are later converting your document to <nop>LaTeX or other typesetting / publication utility. The =svg= format has inline clickable map if used.
		* Set VECTORFORMATS = none

	* Default topic to read library icons (shapefiles) from
		* Set LIBRARY = TWiki.DirectedGraphPlugin

	* Debug plugin: (See output in =data/debug.txt=)
		* Set DEBUG = 0

---++ Plugin Installation Instructions

__Note:__ The following instructions are for the administrator who installs the plugin on the server where TWiki is running. 
	* Install the Graphviz package
	* Install required web fonts
		* Install the <nop>ImageMagick package
	* Install the Perl module Digest::MD5
	* Download the ZIP file from the Plugin web (see below)
	* Unzip ==%TOPIC%.zip== in your twiki installation directory.

Plugin zip content:
	  | *File:* | *Description:* |
	  | ==data/TWiki/%TOPIC%.txt== | Plugin topic |
	  | ==data/TWiki/%TOPIC%.txt,v== | Plugin topic repository |
	  | ==lib/TWiki/Plugins/%TOPIC%.pm== | Plugin Perl module |
	  | ==pub/TWiki/%TOPIC%/graphsample.png== | sample image |
	  | ==pub/TWiki/%TOPIC%/graphsample2.png== | sample image |

Dependencies:
	  | *Package:* | *Description:* |
	  | Graphviz dot | Preprocessor for drawing directed graphs |
	  | <nop>ImageMagick | Postprocessor for antialising rendered graphs (optional) |
	  | <nop>gs | Ghostscript interpreter for antialising rendered graphs (optional) |
	  | Digest::MD5 | MD5 Perl module |
	  | Web fonts | Fonts required for dot's png creations |
	* Customize paths to executables to your environment (in =DirectedGraphPlugin.pm= set =$enginePath=, =$dotHelperPath=, =$execCmd=, =$antialiasCmd= to correct paths for your environment)
	* (Dakar) Visit =configure= in your TWiki installation, and enable the plugin in the {Plugins} section.

To install the web fonts, download this [[http://biostat.mc.vanderbilt.edu/twiki/pub/TWiki/DirectedGraphPlugin/webfonts-1.0-5.noarch.rpm][rpm]] and run the command *rpm --install webfonts-1.0-5.noarch.rpm* (Red Hat only).

---++ Plugin Info

|  Plugin Author: | TWiki:Main/ColeBeck |
|  Plugin Version: | 27 Jul 2006 (V1.300) |
|  Change History: | <!-- versions below in reverse order -->&nbsp; |
|  02 Mar 2007: | Updated link generation (img src) to be compatible with <nop>I18N webs and topics -- TWiki:Main.SteffenPoulsen |
|  27 Jul 2006: | Error messages from graphviz binary now reported to topic. Check for succesful graphviz binary execution corrected (patch by TWiki:Main.JChristophFuchs). -- TWiki:Main.SteffenPoulsen |
|  12 Jun 2006: | Optional antialias parameter added  (using <nop>ImageMagick). Support for custom icons (shapefiles) added. Support for five layout engines added. Support for attaching vectorbased renderings added. -- TWiki:Main.SteffenPoulsen |
|  16 Apr 2006: | Minor fix for areamap (Firefox compatibility)  -- TWiki:Main.SteffenPoulsen |
|  12 Apr 2006: | Incorporated Sandbox security mechanism  -- TWiki:Main.SteffenPoulsen |
|  24 Oct 2005: | Incorporated areamap patch (TWiki:Main.MagnusLewisSmith)  -- TWiki:Main.JoanTouzet |
|  13 Apr 2005: | Added clientside maps functionality; correctly finds pub directory |
|  25 Mar 2005: | Cleaner code |
|  01 Jul 2004: | Initial version |
|  TWiki Dependency: | $TWiki::Plugins::VERSION 1.024 |
|  CPAN Dependencies: | CPAN:Digest::MD5 |
|  Other Dependencies: | Graphviz (from http://www.graphviz.org/) and <nop>ImageMagick (from http://www.imagemagick.org/). <nop>ImageMagick is optional and needed only for creating antialiased graphs. |
|  Perl Version: | 5.005 |
|  TWiki:Plugins/Benchmark: | %SYSTEMWEB%.GoodStyle 100%, %SYSTEMWEB%.FormattedSearch 100%, %TOPIC% 100% |
|  Plugin Home: | http://twiki.org/cgi-bin/view/Plugins/DirectedGraphPlugin |
|  Feedback: | http://twiki.org/cgi-bin/view/Plugins/DirectedGraphPluginDev |
|  Appraisal: | http://twiki.org/cgi-bin/view/Plugins/DirectedGraphPluginAppraisal |

__Related Topics:__ %SYSTEMWEB%.TWikiPreferences, %SYSTEMWEB%.TWikiPlugins

-- TWiki:Main.ColeBeck - 01 Jul 2004



%META:FILEATTACHMENT{name="graphsample.png" attr="h" autoattached="1" comment="Sample DOT graph" date="1145864654" path="graphsample.png" size="5197" user="TWikiContributor" version=""}%
%META:FILEATTACHMENT{name="Sun_Workstation.png" attr="h" autoattached="1" comment="Cisco library icon for sample graph" date="1150143270" path="Sun_Workstation.png" size="6223" user="TWikiContributor" version=""}%
%META:FILEATTACHMENT{name="sample_simple_lan_setup.png" attr="h" autoattached="1" comment="Sample DOT graph" date="1150144845" path="sample_simple_lan_setup.png" size="28102" user="Main.TWikiContributor" version="1"}%
%META:FILEATTACHMENT{name="graphsample2.png" attr="h" autoattached="1" comment="Sample DOT graph" date="1145864654" path="graphsample2.png" size="1364" user="TWikiContributor" version=""}%
%META:FILEATTACHMENT{name="graphsample2_antialiased.png" attr="h" autoattached="1" comment="Antialiased sample" date="1150068177" path="graphsample2_antialiased.png" size="12577" user="Main.TWikiContributor" version="1"}%
%META:FILEATTACHMENT{name="Cloud-Filled.png" attr="h" autoattached="1" comment="Cisco library icon for sample graph" date="1150143256" path="Cloud-Filled.png" size="8648" user="TWikiContributor" version=""}%
%META:FILEATTACHMENT{name="Workgroup_Switch.png" attr="h" autoattached="1" comment="Cisco library icon for sample graph" date="1150143252" path="Workgroup_Switch.png" size="6688" user="TWikiContributor" version=""}%
%META:FILEATTACHMENT{name="Laptop.png" attr="h" autoattached="1" comment="Cisco library icon for sample graph" date="1150144462" path="Laptop.png" size="7372" user="TWikiContributor" version=""}%
%META:FILEATTACHMENT{name="sample_component_architecture.png" attr="h" autoattached="1" comment="Sample DOT graph" date="1150125502" path="sample_component_architecture.png" size="51946" user="Main.TWikiContributor" version="1"}%
%META:FILEATTACHMENT{name="Printer.png" attr="h" autoattached="1" comment="Cisco library icon for sample graph" date="1150143276" path="Printer.png" size="7747" user="TWikiContributor" version=""}%
%META:FILEATTACHMENT{name="Wireless_Router.png" attr="h" autoattached="1" comment="Cisco library icon for sample graph" date="1150143262" path="Wireless_Router.png" size="7771" user="TWikiContributor" version=""}%
%META:FILEATTACHMENT{name="usecase_sample.png" attr="h" autoattached="1" comment="DOT usecase sample" date="1150067973" path="usecase_sample.png" size="109307" user="Main.TWikiContributor" version="1"}%
