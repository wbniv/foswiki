var twiki;if(twiki==undefined){twiki={};}twiki.AjaxRequest=function(){var _1=this;var _2={};var _3="TWIKI_ADDED_SCRIPT_";var _4=function(_5){this.name=_5;this.url;this.response;this.lockedProperties={};this.handler="_writeHtml";this.scope=twiki.AjaxRequest.getInstance();this.container;this.type="text";this.cache=false;this.method="GET";this.postData;this.indicator;this.failHandler="_defaultFailHandler";this.failScope=twiki.AjaxRequest.getInstance();this.owner=twiki.AjaxRequest.getInstance();this.scriptNodeIds=[];};_4.prototype.toString=function(){return "name="+this.name+"; handler="+this.handler+"; scope="+this.scope.toString()+"; container="+this.container+"; url="+this.url+"; type="+this.type+"; cache="+this.cache+"; method="+this.method+"; postData="+this.postData+"; indicator="+this.indicator+"; response="+this.response;};function _getIndicatorId(_6){return "twikiRequestIndicator"+_6;}function _wrapIndicator(_7,_8){return "<span id=\""+_getIndicatorId(_7)+"\">"+_8+"</span>";}function _hideLoadingIndicator(_9){twiki.HTML.deleteElementWithId(_getIndicatorId(_9));}function _storeProperty(_a,_b,_c){if(_c==undefined){return;}if(_a.lockedProperties[_b]){return;}_a[_b]=_c;}function _referenceForResponse(_d){for(var i in _2){var _f=_2[i].response;if(_f&&_f.tId==_d.tId){return _2[i];}}return null;}function _createScriptNode(_10){var _11=document.createElement("script");_11.id=_10;_11.setAttribute("language","javascript");_11.setAttribute("type","text/javascript");return _11;}function _addScriptCodeToHead(_12,_13,_14){var _15=_createScriptNode(_13);if(navigator&&navigator.vendor&&navigator.vendor.search(/Apple/)!=-1){var _16=document.createTextNode(_14);_15.appendChild(_16);}else{_15.text=_14;}_12.appendChild(_15);}function _addScriptUrlToHead(_17,_18,_19){var _1a=_createScriptNode(_18);_1a.setAttribute("src",_19);var _1b=_17.appendChild(_1a);return _1b;}function _removeScriptsFromHead(_1c){var _1d=document.getElementsByTagName("head").item(0);var ref=_2[_1c];if(!ref){return;}for(var i=0;i<ref.scriptNodeIds.length;i++){var id=ref.scriptNodeIds[i];_removeScriptFromHead(_1d,id);}ref.scriptNodeIds=[];return _1d;}function _removeScriptFromHead(_21,_22){var old=document.getElementById(_22);if(old){_21.removeChild(old);}}function _createScriptNodeId(_24){var _25=_24.scriptNodeIds.length;return _3+_24.name+"_"+_25;}this._load=function(_26,_27){var ref=this._storeProperties(_26,_27);if(!ref){return;}this._stop(_26);if(ref.store){if(ref.type=="text"||ref.type=="xml"){return this._writeHtml(ref.container,ref.store);}if(ref.type=="script"||ref.type=="scriptfile"){return null;}}if(ref.type=="scriptfile"){var _29=_1._addScriptUrlToHead(ref.name,ref.url);if(ref.cache){_1._storeProcessedResponse(ref.name,_29);}return null;}if(ref.scope==undefined){alert("twiki.AjaxRequest._load: no scope given for function "+ref.handler);return;}var _2a=null;if(ref.indicator!=null){_2a=ref.indicator;}if(_2a==null){_2a=this._defaultIndicatorHtml;}var _2b=_wrapIndicator(_26,_2a);twiki.HTML.setHtmlOfElementWithId(ref.container,_2b);var _2c=(ref.cache!=undefined)?ref.cache:false;var _2d={success:this._handleSuccess,failure:this._handleFailure,argument:{container:ref.container,cache:ref.cache}};var _2e=(ref.method!=undefined)?ref.method:"GET";var _2f=(ref.postData!=undefined)?ref.postData:"";var _30=YAHOO.util.Connect.asyncRequest(_2e,ref.url,_2d,_2f);this._storeProperties(_26,{response:_30});return _30;};this._storeProperties=function(_31,_32){var ref=_2[_31];if(!ref){ref=new _4(_31);}if(!_32){_2[_31]=ref;return ref;}_storeProperty(ref,"url",_32.url);_storeProperty(ref,"response",_32.response);_storeProperty(ref,"handler",_32.handler);_storeProperty(ref,"scope",_32.scope);_storeProperty(ref,"container",_32.container);_storeProperty(ref,"type",_32.type);_storeProperty(ref,"cache",_32.cache);_storeProperty(ref,"method",_32.method);_storeProperty(ref,"postData",_32.postData);_storeProperty(ref,"indicator",_32.indicator);_storeProperty(ref,"failHandler",_32.failHandler);_storeProperty(ref,"failScope",_32.failScope);_2[_31]=ref;return ref;};this._lockProperties=function(_34,_35){if(!_35||_35.length==0){return;}var ref=_2[_34];if(!ref){return;}var i,ilen=_35.length;for(i=0;i<ilen;i++){var _38=_35[i];ref.lockedProperties[_38]=true;}};this._releaseProperties=function(_39,_3a){if(!_3a||_3a.length==0){return;}var ref=_2[_39];if(!ref){return;}var i,ilen=_3a.length;for(i=0;i<ilen;i++){var _3d=_3a[i];delete ref.lockedProperties[_3d];}};this._stop=function(_3e){_hideLoadingIndicator(_3e);var ref=_2[_3e];if(!ref){return;}if(ref.response){YAHOO.util.Connect.abort(ref.response);}};this._handleSuccess=function(_40){if(_40.responseText!==undefined){var ref=_referenceForResponse(_40);_hideLoadingIndicator(ref.name);var _42;var _43=(ref.type=="xml")?_40.responseXML:_40.responseText;if(ref.type=="script"){_42=_1._addScriptToHead(ref.name,_43);}else{_42=ref.scope[ref.handler].apply(ref.scope,[ref.container,_43]);}if(ref.cache){_1._storeProcessedResponse(ref.name,_42);}}};this._handleFailure=function(_44){var ref=_referenceForResponse(_44);if(!ref){return;}ref.owner._stop(ref.name);var _46=ref.failScope[ref.failHandler].apply(ref.failScope,[ref.name,_44.status]);};this._defaultFailHandler=function(_47,_48){alert("Could not load request for "+_47+" because of (error status): "+_48);};this._addScriptUrlToHead=function(_49,_4a){var _4b=_removeScriptsFromHead(_49);var ref=_2[_49];if(!ref){return;}var id=_createScriptNodeId(ref);var _4e=_addScriptUrlToHead(_4b,id,_4a);if(_4e){ref.scriptNodeIds.push(id);return 1;}return 0;};this._addScriptToHead=function(_4f,_50){var _51=_removeScriptsFromHead(_4f);var ref=_2[_4f];if(!ref){return;}var _53=_50;_53=_53.replace(new RegExp("^\\s*|\\s*$"),"");_53=_53.replace(new RegExp("//\\s*<!\\[CDATA\\[","gmi"),"/* <![CDATA[ */");_53=_53.replace(new RegExp("//\\s*]]>","gmi"),"/* ]]> */");_53=_53.replace(new RegExp("\\n|\\r","g"),";");var _54=new RegExp("<script.*?src\\s*=\\s*\"(.*?)\">.*?</script>","gmi");var _55;var _56=0;while((_55=_54.exec(_53))!=null){var url=_55[1];if(url){var id=_createScriptNodeId(ref);_addScriptUrlToHead(_51,id,url);ref.scriptNodeIds.push(id);_56=1;}}_53=_53.replace(_54,"");if(_53.length==0&&_56){return 1;}var _59=new RegExp("<script.*?>\\s*(.*?)\\s*</script>","gmi");var _5a=0;while((_55=_59.exec(_53))!=null){var _5b=_55[1];if(_5b.length>0){var id=_createScriptNodeId(ref);_addScriptCodeToHead(_51,id,_5b);ref.scriptNodeIds.push(id);_5a=1;}}if(!_5a){var id=_createScriptNodeId(ref);_addScriptCodeToHead(_51,id,_53);ref.scriptNodeIds.push(id);}return 1;};this._storeProcessedResponse=function(_5e,_5f){var ref=_2[_5e];if(!ref){return;}ref.store=_5f;};this._clearCache=function(_61){var ref=_2[_61];if(!ref){return;}this._storeProcessedResponse(_61,null);if(ref.type=="script"||ref.type=="scriptfile"){_removeScriptsFromHead(_61);}};this._writeHtml=function(_63,_64){var _65=twiki.HTML.setHtmlOfElementWithId(_63,_64);return twiki.HTML.getHtmlOfElementWithId(_63);};this._defaultIndicatorHtml="<img src='indicator.gif' alt='' />";this._setDefaultIndicatorHtml=function(_66){if(!_66){return;}this._defaultIndicatorHtml=_66;};};twiki.AjaxRequest.__instance__=null;twiki.AjaxRequest.getInstance=function(){if(this.__instance__==null){this.__instance__=new twiki.AjaxRequest();}return this.__instance__;};twiki.AjaxRequest.setProperties=function(_67,_68){twiki.AjaxRequest.getInstance()._storeProperties(_67,_68);};twiki.AjaxRequest.lockProperties=function(_69){var _6a=twiki.Array.convertArgumentsToArray(arguments,1);if(!_6a){return;}twiki.AjaxRequest.getInstance()._lockProperties(_69,_6a);};twiki.AjaxRequest.releaseProperties=function(_6b,_6c){var _6d=twiki.Array.convertArgumentsToArray(arguments,1);if(!_6d){return;}twiki.AjaxRequest.getInstance()._releaseProperties(_6b,_6d);};twiki.AjaxRequest.clearCache=function(_6e){twiki.AjaxRequest.getInstance()._clearCache(_6e);};twiki.AjaxRequest.load=function(_6f,_70){return twiki.AjaxRequest.getInstance()._load(_6f,_70);};twiki.AjaxRequest.stop=function(_71){twiki.AjaxRequest.getInstance()._stop();};twiki.AjaxRequest.getDefaultIndicatorHtml=function(){return twiki.AjaxRequest.getInstance()._defaultIndicatorHtml;};twiki.AjaxRequest.setDefaultIndicatorHtml=function(_72){return twiki.AjaxRequest.getInstance()._setDefaultIndicatorHtml(_72);};