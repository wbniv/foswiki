%META:TOPICINFO{author="ProjectContributor" date="1176591878" format="1.1" reprev="1.1" version="1.1"}%
---+!! Attach Content Plugin

*Saves dynamic topic text to an attachment.*

%TOC%

---++ Overview

This plugin puts any text between a =%<nop>STARTATTACH{"filename"}%= and =%<nop>ENDATTACH%= into an attachment with the given filename.

Pass filename, topic, web or comment as parameters.

The current version only refreshes the attachment when the topic is saved. Obviously this means that the attachment can get out of synch if, for example, it explicitly or implicitly refers to other topics.

This plugin is written specifically to be able to put css into topic(s) and still be able to have efficient stylesheets: i.e., without the overhead of TWiki processing. The feature can be used for many other things where you want TWiki to generate a plain text file a smart way. %BR%
For example: write a =SEARCH= in a topic and save the search results to an XML file. The XML data can be used for efficient look-up.

---++ Syntax Rules

Write:

<pre>
%<nop>STARTATTACH{"filename"}%
content-to-be-saved
%<nop>ENDATTACH%
</pre>

You can pass a number of parameters:

---+++ Parameters
| *Parameter* | *Description* | *Default* | *Example* |
| =topic=       | Topic to save the attachment to.  | =none= (the current topic is used) | =topic="WebHome"= |
| =web=         | Web where the save topic is located.  | =none= (the current Web is used) | =web="Main"= |
| =comment=     | Attachment comment text.  | the default =ATTACHCONTENTCOMMENT= text (see [[#PluginSettings][Plugin Settings]] below)  | =comment="User data as of %<nop>DATE%"= |
| =hide=        | Use =hide="on"= to hide the attachment in normal topic view.  | =off= | =hide="on"= |
| =keeppars=    | Keep paragraph &lt;p /&gt; tags, &lt;nop&gt; tags, and square bracket type links | The default =KEEPPARS= setting (see [[#PluginSettings][Plugin Settings]] below) | =keeppars="on"= |


---++ Examples

---+++ Creating a color scheme

See: PatternSkinColorSettings. This topic uses !AttachContentPlugin to write a CSS file for colors. Color values are set dynamically in the topic. On topic save the CSS file is attached to the topic and can be referred to using variable =USERCOLORSURL=.

#UserDataXml
---+++ User data XML

<a href="%SCRIPTURL{save}%/%WEB%/%TOPIC%?action_save=1">Update user data XML</a>

<verbatim>
%STARTATTACH{"userdata.xml" comment="User data as of %DATE%"}%
<?xml version="1.0" encoding="ISO-8859-1"?>
<users>
%SEARCH{ "[F]irstName.*value=.*()" web="%MAINWEB%" type="regex" nonoise="on" excludetopic="UserForm,ProjectContributor,WikiGuest,UnknownUser" format="<user><firstname><![CDATA[$formfield(FirstName)]]></firstname><lastname><![CDATA[$formfield(LastName)]]></lastname><url><![CDATA[%SCRIPTURL{view}%/%WEB%/$topic]]></url></user>" }%
</users>
%ENDATTACH%
</verbatim>

#PluginSettings
---++ Plugin Settings

Plugin settings are stored as preferences variables. To reference a plugin setting write ==%<nop>&lt;plugin&gt;_&lt;setting&gt;%==, i.e. ==%<nop>CACHECONTENTPLUGIN_SHORTDESCRIPTION%==

   * One line description, is shown in the %SYSTEMWEB%.TextFormattingRules topic:
      * Set SHORTDESCRIPTION = Saves dynamic topic text to an attachment

   * Debug plugin: (See output in =data/debug.txt=)
      * Set DEBUG = 0

   * Keep paragraph  &lt;p /&gt; tags, &lt;nop&gt; tags, and square bracket type links:
      * Set KEEPPARS = 0
      
   * The default comment text:
      * Set ATTACHCONTENTCOMMENT = Generated by !AttachContentPlugin

---++ Plugin Installation Instructions

__Note:__ You do not need to install anything on the browser to use this plugin. The following instructions are for the administrator who installs the plugin on the server where TWiki is running. 

   * Download the ZIP file from the Plugin web (see below)
   * Unzip ==%TOPIC%.zip== in your twiki installation directory. Content:
     | *File:* | *Description:* |
     | ==data/System/%TOPIC%.txt== | Plugin topic |
     | ==data/System/%TOPIC%.txt,v== | Plugin topic repository |
     | ==lib/Foswiki/Plugins/%TOPIC%.pm== | Plugin Perl module |
   * Enable the plugin in =configure=
   * Test if the installation was successful: <a href="%SCRIPTURL{save}%/%WEB%/%TOPIC%?action_save=1">Update user data XML</a> to see if an attachment is created/updated

---++ Plugin Info

|  Copyright: | &copy; TWiki:Main.MeredithLesly, TWiki:Main.KennethLavrsen, TWiki:Main.ArthurClemens |
|  Plugin Version: | 23 Nov 2008 (V2.2.1) |
|  Change History: | <!-- versions below in reverse order -->&nbsp; |
|  23 Nov 2008 (2.2.1) | Foswiki compatible. |
|  16 Apr 2007 (2.2.0) | Kenneth Lavrsen: Add added =keeppars= parameter. Settings change to being plugin settings only. Removal of plugin tags fixed so text between is still visible. |
|  15 Apr 2007 (2.1.0) | Arthur Clemens: added parameters =web=, =topic=, =comment= and =hide=. Plugin tags are removed from view. Added configurable default comment. |
|  19 Oct 2006 (2.0) | TWiki:Main.KennethLavrsen<br />Fixed major security issue. Original version allowed /../ in the filename so files could be stored everywhere<br />Plugin now cleans up the its work area and no longer leaves temporary files<br />Temporary filenames made pseudo random to avoid race condition<br />Plugin now also removed nops and TML square bracket links<br />Attachment is no longer saved when uploading other files and changing attributes. |
|  09 Feb 2006 (1.0) | Initial version |
|  TWiki Dependency: | $Foswiki::Plugins::VERSION 1.1 |
|  CPAN Dependencies: | none |
|  Other Dependencies: | none |
|  Perl Version: | 5.005 |
|  License: | GPL ([[http://www.gnu.org/copyleft/gpl.html][GNU General Public License]]) |
|  Plugin Home: | http://foswiki.org/Extensions/%TOPIC% |
|  Support: | http://foswiki.org/Support/%TOPIC% |

